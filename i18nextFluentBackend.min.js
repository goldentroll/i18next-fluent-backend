!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.i18nextFluentBackend=t()}(this,function(){"use strict";let e=[],t=e.forEach,n=e.slice;function r(e,t){if(t&&"object"==typeof t){let n="",r=encodeURIComponent;for(let e in t)n+="&"+r(e)+"="+r(t[e]);if(!n)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+n.slice(1)}return e}function s(e,t,n,s,i){s&&"object"==typeof s&&(i||(s._t=new Date),s=r("",s).slice(1)),t.queryStringParams&&(e=r(e,t.queryStringParams));try{var a;(a=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0")).open(s?"POST":"GET",e,1),t.crossDomain||a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.withCredentials=!!t.withCredentials,s&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.overrideMimeType&&a.overrideMimeType("application/json");var o=t.customHeaders;if(o)for(var u in o)a.setRequestHeader(u,o[u]);a.onreadystatechange=function(){a.readyState>3&&n&&n(a.responseText,a)},a.send(s)}catch(e){console&&console.log(e)}}class i{constructor(){}}class a extends i{addSpan(e,t){this.span=new j(e,t)}}class o extends a{constructor(e=[]){super(),this.type="Resource",this.body=e}}class u extends a{}class c extends u{constructor(e,t=null,n=[],r=null){super(),this.type="Message",this.id=e,this.value=t,this.attributes=n,this.comment=r}}class h extends u{constructor(e,t,n=[],r=null){super(),this.type="Term",this.id=e,this.value=t,this.attributes=n,this.comment=r}}class l extends a{constructor(e){super(),this.type="VariantList",this.variants=e}}class p extends a{constructor(e){super(),this.type="Pattern",this.elements=e}}class f extends a{}class d extends f{constructor(e){super(),this.type="TextElement",this.value=e}}class k extends f{constructor(e){super(),this.type="Placeable",this.expression=e}}class g extends a{}class x extends g{constructor(e){super(),this.type="StringLiteral",this.value=e}}class m extends g{constructor(e){super(),this.type="NumberLiteral",this.value=e}}class w extends g{constructor(e){super(),this.type="MessageReference",this.id=e}}class E extends g{constructor(e){super(),this.type="TermReference",this.id=e}}class y extends g{constructor(e){super(),this.type="VariableReference",this.id=e}}class I extends g{constructor(e,t){super(),this.type="SelectExpression",this.selector=e,this.variants=t}}class b extends g{constructor(e,t){super(),this.type="AttributeExpression",this.ref=e,this.name=t}}class P extends g{constructor(e,t){super(),this.type="VariantExpression",this.ref=e,this.key=t}}class S extends g{constructor(e,t=[],n=[]){super(),this.type="CallExpression",this.callee=e,this.positional=t,this.named=n}}class v extends a{constructor(e,t){super(),this.type="Attribute",this.id=e,this.value=t}}class C extends a{constructor(e,t,n=!1){super(),this.type="Variant",this.key=e,this.value=t,this.default=n}}class $ extends a{constructor(e,t){super(),this.type="NamedArgument",this.name=e,this.value=t}}class V extends a{constructor(e){super(),this.type="Identifier",this.name=e}}class L extends V{constructor(e){super(e),this.type="VariantName"}}class A extends u{constructor(e){super(),this.type="BaseComment",this.content=e}}class T extends A{constructor(e){super(e),this.type="Comment"}}class N extends A{constructor(e){super(e),this.type="GroupComment"}}class R extends A{constructor(e){super(e),this.type="ResourceComment"}}class W extends V{constructor(e){super(e),this.type="Function"}}class M extends a{constructor(e){super(),this.type="Junk",this.annotations=[],this.content=e}addAnnotation(e){this.annotations.push(e)}}class j extends i{constructor(e,t){super(),this.type="Span",this.start=e,this.end=t}}class D extends a{constructor(e,t=[],n){super(),this.type="Annotation",this.code=e,this.args=t,this.message=n}}class q{constructor(e){this.string=e,this.iter=e[Symbol.iterator](),this.buf=[],this.peekIndex=0,this.index=0,this.iterEnd=!1,this.peekEnd=!1,this.ch=this.iter.next().value}next(){if(!this.iterEnd)return 0===this.buf.length?this.ch=this.iter.next().value:this.ch=this.buf.shift(),this.index++,void 0===this.ch&&(this.iterEnd=!0,this.peekEnd=!0),this.peekIndex=this.index,this.ch}current(){return this.ch}currentIs(e){return this.ch===e}currentPeek(){if(this.peekEnd)return;const e=this.peekIndex-this.index;return 0===e?this.ch:this.buf[e-1]}currentPeekIs(e){return this.currentPeek()===e}peek(){if(this.peekEnd)return;this.peekIndex+=1;const e=this.peekIndex-this.index;if(e>this.buf.length){const e=this.iter.next().value;if(void 0===e)return void(this.peekEnd=!0);this.buf.push(e)}return this.buf[e-1]}getIndex(){return this.index}getPeekIndex(){return this.peekIndex}peekCharIs(e){if(this.peekEnd)return!1;const t=this.peek();return this.peekIndex-=1,t===e}resetPeek(e){e?(e<this.peekIndex&&(this.peekEnd=!1),this.peekIndex=e):(this.peekIndex=this.index,this.peekEnd=this.iterEnd)}skipToPeek(){const e=this.peekIndex-this.index;for(let t=0;t<e;t++)this.ch=this.buf.shift();this.index=this.peekIndex}getSlice(e,t){return this.string.substring(e,t)}}class z extends Error{constructor(e,...t){super(),this.code=e,this.args=t,this.message=function(e,t){switch(e){case"E0001":return"Generic error";case"E0002":return"Expected an entry start";case"E0003":{const[e]=t;return`Expected token: "${e}"`}case"E0004":{const[e]=t;return`Expected a character from range: "${e}"`}case"E0005":{const[e]=t;return`Expected message "${e}" to have a value or attributes`}case"E0006":{const[e]=t;return`Expected term "${e}" to have a value`}case"E0007":return"Keyword cannot end with a whitespace";case"E0008":return"The callee has to be a simple, upper-case identifier";case"E0009":return"The key has to be a simple identifier";case"E0010":return"Expected one of the variants to be marked as default (*)";case"E0011":return'Expected at least one variant after "->"';case"E0012":return"Expected value";case"E0013":return"Expected variant key";case"E0014":return"Expected literal";case"E0015":return"Only one variant can be marked as default (*)";case"E0016":return"Message references cannot be used as selectors";case"E0017":return"Variants cannot be used as selectors";case"E0018":return"Attributes of messages cannot be used as selectors";case"E0019":return"Attributes of terms cannot be used as placeables";case"E0020":return"Unterminated string expression";case"E0021":return"Positional arguments must not follow named arguments";case"E0022":return"Named arguments must be unique";case"E0023":return"VariantLists are only allowed inside of other VariantLists.";case"E0024":return"Cannot access variants of a message.";case"E0025":{const[e]=t;return`Unknown escape sequence: \\${e}.`}case"E0026":{const[e]=t;return`Invalid Unicode escape sequence: \\u${e}.`}default:return e}}(e,t)}}function B(e,t){return e.indexOf(t)>-1}const O=[" ","\t"],U=["}",".","[","*"];class J extends q{skipInlineWS(){for(;this.ch&&B(O,this.ch);)this.next()}peekInlineWS(){let e=this.currentPeek();for(;e&&B(O,e);)e=this.peek()}skipBlankLines(){let e=0;for(;;){if(this.peekInlineWS(),!this.currentPeekIs("\n"))return this.resetPeek(),e;this.skipToPeek(),this.next(),e++}}peekBlankLines(){for(;;){const e=this.getPeekIndex();if(this.peekInlineWS(),!this.currentPeekIs("\n")){this.resetPeek(e);break}this.peek()}}skipIndent(){this.skipBlankLines(),this.skipInlineWS()}expectChar(e){if(this.ch===e)return this.next(),!0;if("\n"===e)throw new z("E0003","␤");throw new z("E0003",e)}expectIndent(){this.expectChar("\n"),this.skipBlankLines(),this.expectChar(" "),this.skipInlineWS()}expectLineEnd(){return void 0===this.ch||this.expectChar("\n")}takeChar(e){const t=this.ch;if(void 0!==t&&e(t))return this.next(),t}isCharIDStart(e){if(void 0===e)return!1;const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90}isIdentifierStart(){const e=this.currentPeek(),t=this.isCharIDStart(e);return this.resetPeek(),t}isNumberStart(){const e=this.currentIs("-")?this.peek():this.current();if(void 0===e)return this.resetPeek(),!1;const t=e.charCodeAt(0),n=t>=48&&t<=57;return this.resetPeek(),n}isCharPatternContinuation(e){return void 0!==e&&!B(U,e)}isPeekValueStart(){this.peekInlineWS();const e=this.currentPeek();return void 0!==e&&"\n"!==e||this.isPeekNextLineValue()}isPeekNextLineComment(e=-1){if(!this.currentPeekIs("\n"))return!1;let t=0;for(;t<=e||-1===e&&t<3;){if(this.peek(),!this.currentPeekIs("#")){if(t<=e&&-1!==e)return this.resetPeek(),!1;break}t++}return this.peek(),[" ","\n"].includes(this.currentPeek())?(this.resetPeek(),!0):(this.resetPeek(),!1)}isPeekNextLineVariantStart(){if(!this.currentPeekIs("\n"))return!1;this.peek(),this.peekBlankLines();const e=this.getPeekIndex();return this.peekInlineWS(),this.getPeekIndex()-e==0?(this.resetPeek(),!1):(this.currentPeekIs("*")&&this.peek(),this.currentPeekIs("[")&&!this.peekCharIs("[")?(this.resetPeek(),!0):(this.resetPeek(),!1))}isPeekNextLineAttributeStart(){if(!this.currentPeekIs("\n"))return!1;this.peek(),this.peekBlankLines();const e=this.getPeekIndex();return this.peekInlineWS(),this.getPeekIndex()-e==0?(this.resetPeek(),!1):this.currentPeekIs(".")?(this.resetPeek(),!0):(this.resetPeek(),!1)}isPeekNextLineValue(){if(!this.currentPeekIs("\n"))return!1;this.peek(),this.peekBlankLines();const e=this.getPeekIndex();return this.peekInlineWS(),this.getPeekIndex()-e==0?(this.resetPeek(),!1):this.isCharPatternContinuation(this.currentPeek())?(this.resetPeek(),!0):(this.resetPeek(),!1)}skipToNextEntryStart(){for(;this.ch&&!(this.currentIs("\n")&&!this.peekCharIs("\n")&&(this.next(),void 0===this.ch||this.isIdentifierStart()||this.currentIs("-")||this.currentIs("#")));)this.next()}takeIDStart(){if(this.isCharIDStart(this.ch)){const e=this.ch;return this.next(),e}throw new z("E0004","a-zA-Z")}takeIDChar(){return this.takeChar(e=>{const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||95===t||45===t})}takeVariantNameChar(){return this.takeChar(e=>{const t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||95===t||45===t||32===t})}takeDigit(){return this.takeChar(e=>{const t=e.charCodeAt(0);return t>=48&&t<=57})}takeHexDigit(){return this.takeChar(e=>{const t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102})}}const H=/[ \t\n\r]+$/;function X(e){return function(t,...n){if(!this.withSpans)return e.call(this,t,...n);const r=t.getIndex(),s=e.call(this,t,...n);if(s.span)return s;const i=t.getIndex();return s.addSpan(r,i),s}}class F{constructor({withSpans:e=!0}={}){this.withSpans=e;const t=["getComment","getMessage","getTerm","getAttribute","getIdentifier","getTermIdentifier","getVariant","getVariantName","getNumber","getValue","getPattern","getVariantList","getTextElement","getPlaceable","getExpression","getSelectorExpression","getCallArg","getString","getLiteral","getVariantList"];for(const e of t)this[e]=X(this[e])}parse(e){const t=new J(e);t.skipBlankLines();const n=[];let r=null;for(;t.current();){const e=this.getEntryOrJunk(t),s=t.skipBlankLines();"Comment"===e.type&&0===s&&t.current()?r=e:(r&&("Message"===e.type||"Term"===e.type?(e.comment=r,this.withSpans&&(e.span.start=e.comment.span.start)):n.push(r),r=null),n.push(e))}const s=new o(n);return this.withSpans&&s.addSpan(0,t.getIndex()),s}parseEntry(e){const t=new J(e);for(t.skipBlankLines();t.currentIs("#");){const e=this.getEntryOrJunk(t);if("Junk"===e.type)return e;t.skipBlankLines()}return this.getEntryOrJunk(t)}getEntryOrJunk(e){const t=e.getIndex();try{const n=this.getEntry(e);return e.expectLineEnd(),n}catch(n){if(!(n instanceof z))throw n;const r=e.getIndex();e.skipToNextEntryStart();const s=e.getIndex(),i=e.getSlice(t,s),a=new M(i);this.withSpans&&a.addSpan(t,s);const o=new D(n.code,n.args,n.message);return o.addSpan(r,r),a.addAnnotation(o),a}}getEntry(e){if(e.currentIs("#"))return this.getComment(e);if(e.currentIs("-"))return this.getTerm(e);if(e.isIdentifierStart())return this.getMessage(e);throw new z("E0002")}getComment(e){let t,n=-1,r="";for(;;){let t=-1;for(;e.currentIs("#")&&t<(-1===n?2:n);)e.next(),t++;if(-1===n&&(n=t),!e.currentIs("\n")){let t;for(e.expectChar(" ");t=e.takeChar(e=>"\n"!==e);)r+=t}if(!e.isPeekNextLineComment(n))break;r+=e.current(),e.next()}switch(n){case 0:t=T;break;case 1:t=N;break;case 2:t=R}return new t(r)}getMessage(e){const t=this.getIdentifier(e);if(e.skipInlineWS(),e.expectChar("="),e.isPeekValueStart()){e.skipIndent();var n=this.getPattern(e)}else e.skipInlineWS();if(e.isPeekNextLineAttributeStart())var r=this.getAttributes(e);if(void 0===n&&void 0===r)throw new z("E0005",t.name);return new c(t,n,r)}getTerm(e){const t=this.getTermIdentifier(e);if(e.skipInlineWS(),e.expectChar("="),!e.isPeekValueStart())throw new z("E0006",t.name);e.skipIndent();var n=this.getValue(e);if(e.isPeekNextLineAttributeStart())var r=this.getAttributes(e);return new h(t,n,r)}getAttribute(e){e.expectChar(".");const t=this.getIdentifier(e);if(e.skipInlineWS(),e.expectChar("="),e.isPeekValueStart()){e.skipIndent();const n=this.getPattern(e);return new v(t,n)}throw new z("E0012")}getAttributes(e){const t=[];for(;;){e.expectIndent();const n=this.getAttribute(e);if(t.push(n),!e.isPeekNextLineAttributeStart())break}return t}getIdentifier(e){let t,n=e.takeIDStart();for(;t=e.takeIDChar();)n+=t;return new V(n)}getTermIdentifier(e){e.expectChar("-");const t=this.getIdentifier(e);return new V(`-${t.name}`)}getVariantKey(e){const t=e.current();if(!t)throw new z("E0013");const n=t.charCodeAt(0);return n>=48&&n<=57||45===n?this.getNumber(e):this.getVariantName(e)}getVariant(e,t){let n=!1;if(e.currentIs("*")){if(t)throw new z("E0015");e.next(),n=!0,t=!0}e.expectChar("[");const r=this.getVariantKey(e);if(e.expectChar("]"),e.isPeekValueStart()){e.skipIndent();const t=this.getValue(e);return new C(r,t,n)}throw new z("E0012")}getVariants(e){const t=[];let n=!1;for(;;){e.expectIndent();const r=this.getVariant(e,n);if(r.default&&(n=!0),t.push(r),!e.isPeekNextLineVariantStart())break}if(!n)throw new z("E0010");return t}getVariantName(e){let t=e.takeIDStart();for(;;){const n=e.takeVariantNameChar();if(!n)break;t+=n}return new L(t.replace(H,""))}getDigits(e){let t,n="";for(;t=e.takeDigit();)n+=t;if(0===n.length)throw new z("E0004","0-9");return n}getNumber(e){let t="";return e.currentIs("-")&&(t+="-",e.next()),t=`${t}${this.getDigits(e)}`,e.currentIs(".")&&(t+=".",e.next(),t=`${t}${this.getDigits(e)}`),new m(t)}getValue(e){return e.currentIs("{")&&(e.peek(),e.peekInlineWS(),e.isPeekNextLineVariantStart())?this.getVariantList(e):this.getPattern(e)}getVariantList(e){e.expectChar("{"),e.skipInlineWS();const t=this.getVariants(e);return e.expectIndent(),e.expectChar("}"),new l(t)}getPattern(e){const t=[];let n;for(e.skipInlineWS();(n=e.current())&&("\n"!==n||e.isPeekNextLineValue());)if("{"===n){const n=this.getPlaceable(e);t.push(n)}else{const n=this.getTextElement(e);t.push(n)}const r=t[t.length-1];return"TextElement"===r.type&&(r.value=r.value.replace(H,"")),new p(t)}getTextElement(e){let t,n="";for(;t=e.current();){if("{"===t)return new d(n);if("\n"!==t)"\\"===t?(e.next(),n+=this.getEscapeSequence(e)):(n+=t,e.next());else{if(!e.isPeekNextLineValue())return new d(n);e.next(),e.skipInlineWS(),n+=t}}return new d(n)}getEscapeSequence(e,t=["{","\\"]){const n=e.current();if(t.includes(n))return e.next(),`\\${n}`;if("u"===n){let t="";e.next();for(let n=0;n<4;n++){const n=e.takeHexDigit();if(void 0===n)throw new z("E0026",t+e.current());t+=n}return`\\u${t}`}throw new z("E0025",n)}getPlaceable(e){e.expectChar("{");const t=this.getExpression(e);return e.expectChar("}"),new k(t)}getExpression(e){e.skipInlineWS();const t=this.getSelectorExpression(e);if(e.skipInlineWS(),e.currentIs("-")){if(e.peek(),!e.currentPeekIs(">"))return e.resetPeek(),t;if("MessageReference"===t.type)throw new z("E0016");if("AttributeExpression"===t.type&&"MessageReference"===t.ref.type)throw new z("E0018");if("VariantExpression"===t.type)throw new z("E0017");e.next(),e.next(),e.skipInlineWS();const n=this.getVariants(e);if(0===n.length)throw new z("E0011");if(n.some(e=>"VariantList"===e.value.type))throw new z("E0023");return e.expectIndent(),new I(t,n)}if("AttributeExpression"===t.type&&"TermReference"===t.ref.type)throw new z("E0019");return t}getSelectorExpression(e){if(e.currentIs("{"))return this.getPlaceable(e);const t=this.getLiteral(e);if("MessageReference"!==t.type&&"TermReference"!==t.type)return t;const n=e.current();if("."===n){e.next();const n=this.getIdentifier(e);return new b(t,n)}if("["===n){if(e.next(),"MessageReference"===t.type)throw new z("E0024");const n=this.getVariantKey(e);return e.expectChar("]"),new P(t,n)}if("("===n){if(e.next(),!/^[A-Z][A-Z_?-]*$/.test(t.id.name))throw new z("E0008");const n=this.getCallArgs(e);e.expectChar(")");const r=new W(t.id.name);return this.withSpans&&r.addSpan(t.span.start,t.span.end),new S(r,n.positional,n.named)}return t}getCallArg(e){const t=this.getSelectorExpression(e);if(e.skipInlineWS(),":"!==e.current())return t;if("MessageReference"!==t.type)throw new z("E0009");e.next(),e.skipInlineWS();const n=this.getArgVal(e);return new $(t.id,n)}getCallArgs(e){const t=[],n=[],r=new Set;for(e.skipInlineWS(),e.skipIndent();")"!==e.current();){const s=this.getCallArg(e);if("NamedArgument"===s.type){if(r.has(s.name.name))throw new z("E0022");n.push(s),r.add(s.name.name)}else{if(r.size>0)throw new z("E0021");t.push(s)}if(e.skipInlineWS(),e.skipIndent(),","!==e.current())break;e.next(),e.skipInlineWS(),e.skipIndent()}return{positional:t,named:n}}getArgVal(e){if(e.isNumberStart())return this.getNumber(e);if(e.currentIs('"'))return this.getString(e);throw new z("E0012")}getString(e){let t,n="";for(e.expectChar('"');t=e.takeChar(e=>'"'!==e&&"\n"!==e);)n+="\\"===t?this.getEscapeSequence(e,["{","\\",'"']):t;if(e.currentIs("\n"))throw new z("E0020");return e.next(),new x(n)}getLiteral(e){const t=e.current();if(!t)throw new z("E0014");if("$"===t){e.next();const t=this.getIdentifier(e);return new y(t)}if(e.isIdentifierStart()){const t=this.getIdentifier(e);return new w(t)}if(e.isNumberStart())return this.getNumber(e);if("-"===t){const t=this.getTermIdentifier(e);return new E(t)}if('"'===t)return this.getString(e);throw new z("E0014")}}function G(e){return e.split("\n").join("\n    ")}function K(e){return"TextElement"===e.type&&B(e.value,"\n")}function Z(e){return"Placeable"===e.type&&"SelectExpression"===e.expression.type}const _=1;class Q{constructor({withJunk:e=!1}={}){this.withJunk=e}serialize(e){if("Resource"!==e.type)throw new Error(`Unknown resource type: ${e.type}`);let t=0;const n=[];for(const r of e.body)("Junk"!==r.type||this.withJunk)&&(n.push(this.serializeEntry(r,t)),t&_||(t|=_));return n.join("")}serializeEntry(e,t=0){switch(e.type){case"Message":case"Term":return function(e){const t=[];e.comment&&t.push(Y(e.comment));t.push(he(e.id)),t.push(" ="),e.value&&t.push(te(e.value));for(const n of e.attributes)t.push(ee(n));return t.push("\n"),t.join("")}(e);case"Comment":return t&_?`\n${Y(e,"#")}\n`:`${Y(e,"#")}\n`;case"GroupComment":return t&_?`\n${Y(e,"##")}\n`:`${Y(e,"##")}\n`;case"ResourceComment":return t&_?`\n${Y(e,"###")}\n`:`${Y(e,"###")}\n`;case"Junk":return e.content;default:throw new Error(`Unknown entry type: ${e.type}`)}}serializeExpression(e){return ie(e)}}function Y(e,t="#"){return`${e.content.split("\n").map(e=>e.length?`${t} ${e}`:t).join("\n")}\n`}function ee(e){return`\n    .${he(e.id)} =${G(te(e.value))}`}function te(e){switch(e.type){case"Pattern":return function(e){const t=e.elements.map(re).join("");if(e.elements.some(Z)||e.elements.some(K))return`\n    ${G(t)}`;return` ${t}`}(e);case"VariantList":return`\n    {${G(e.variants.map(ne).join(""))}\n    }`;default:throw new Error(`Unknown value type: ${e.type}`)}}function ne(e){const t=le(e.key),n=G(te(e.value));return e.default?`\n   *[${t}]${n}`:`\n    [${t}]${n}`}function re(e){switch(e.type){case"TextElement":return e.value;case"Placeable":return se(e);default:throw new Error(`Unknown element type: ${e.type}`)}}function se(e){const t=e.expression;switch(t.type){case"Placeable":return`{${se(t)}}`;case"SelectExpression":return`{ ${ue(t)}}`;default:return`{ ${ie(t)} }`}}function ie(e){switch(e.type){case"StringLiteral":return ae(e);case"NumberLiteral":return oe(e);case"MessageReference":case"TermReference":return function(e){return he(e.id)}(e);case"VariableReference":return function(e){return`$${he(e.id)}`}(e);case"AttributeExpression":return function(e){const t=ie(e.ref),n=he(e.name);return`${t}.${n}`}(e);case"VariantExpression":return function(e){const t=ie(e.ref),n=le(e.key);return`${t}[${n}]`}(e);case"CallExpression":return function(e){const t=function(e){return e.name}(e.callee),n=e.positional.map(ie).join(", "),r=e.named.map(ce).join(", ");if(e.positional.length>0&&e.named.length>0)return`${t}(${n}, ${r})`;return`${t}(${n||r})`}(e);case"SelectExpression":return ue(e);case"Placeable":return se(e);default:throw new Error(`Unknown expression type: ${e.type}`)}}function ae(e){return`"${e.value}"`}function oe(e){return e.value}function ue(e){const t=[],n=`${ie(e.selector)} ->`;t.push(n);for(const n of e.variants)t.push(ne(n));return t.push("\n"),t.join("")}function ce(e){return`${he(e.name)}: ${function(e){switch(e.type){case"StringLiteral":return ae(e);case"NumberLiteral":return oe(e);default:throw new Error(`Unknown argument type: ${e.type}`)}}(e.value)}`}function he(e){return e.name}function le(e){switch(e.type){case"VariantName":return e.name;case"NumberLiteral":return oe(e);default:throw new Error(`Unknown variant key type: ${e.type}`)}}var pe=Object.freeze({FluentParser:F,FluentSerializer:Q,parse:function(e,t){return new F(t).parse(e)},serialize:function(e,t){return new Q(t).serialize(e)},lineOffset:function(e,t){return e.substring(0,t).split("\n").length-1},columnOffset:function(e,t){const n=t-1,r=e.lastIndexOf("\n",n);return-1===r?t:t-r-1},Resource:o,Entry:u,Message:c,Term:h,VariantList:l,Pattern:p,PatternElement:f,TextElement:d,Placeable:k,Expression:g,StringLiteral:x,NumberLiteral:m,MessageReference:w,TermReference:E,VariableReference:y,SelectExpression:I,AttributeExpression:b,VariantExpression:P,CallExpression:S,Attribute:v,Variant:C,NamedArgument:$,Identifier:V,VariantName:L,BaseComment:A,Comment:T,GroupComment:N,ResourceComment:R,Function:W,Junk:M,Span:j,Annotation:D});function fe(e){return"get"+e.type}var de={serialize:function(e){if(this[fe(e)])return this[fe(e)](e);console.warn("unknown type:",e.type,e)},getComment:function(e){return{key:"comment",value:e.content}},getMessage:function(e){return{key:this[fe(e.id)](e.id),value:this[fe(e.value)](e.value),comment:e.comment&&this[fe(e.comment)](e.comment),attributes:e.attributes&&e.attributes.map(e=>this.serialize(e))}},getAttribute:function(e){return{key:this[fe(e.id)](e.id),value:this[fe(e.value)](e.value)}},getTerm:function(e){return{key:this[fe(e.id)](e.id),value:this[fe(e.value)](e.value),comment:e.comment&&this[fe(e.comment)](e.comment),attributes:e.attributes&&e.attributes.map(e=>this.serialize(e))}},getIdentifier:function(e){return e.name},getPattern:function(e){return e.elements.map(e=>e.expression?this[fe(e.expression)]?this[fe(e.expression)](e.expression):console.log("unknown1",fe(e.expression),e.expression):this[fe(e)]?this[fe(e)](e):console.log("unknown2",fe(e),e)).join("")},getTextElement:function(e){return e.value},getSelectExpression:function(e){return"{ $"+this[fe(e.selector)](e.selector,!0)+" ->\n"+e.variants.map(e=>this[fe(e)](e)).join("\n")+"\n}"},getVariantExpression:function(e){const t=this[fe(e.ref)](e.ref,!0),n=this[fe(e.key)](e.key);return n?"{ "+t+"["+n+"] }":" { "+t+" } "},getVariableReference:function(e,t){return t?this[fe(e.id)](e.id):"{ $"+this[fe(e.id)](e.id)+" }"},getTermReference:function(e,t){return t?this[fe(e.id)](e.id):"{ "+this[fe(e.id)](e.id)+" }"},getVariantName:function(e){return e.name},getVariantList:function(e){return"{\n"+e.variants.map(e=>this[fe(e)](e)).join("\n")+"\n}"},getVariant:function(e){const t=e.key.name,n=e.default,r="["+t+"] "+this[fe(e.value)](e.value);return n?" *"+r:"  "+r}};var ke=function(e,t){if("string"!=typeof e){if(!t)throw new Error("The first parameter was not a string");return t(new Error("The first parameter was not a string"))}const n=pe.parse(e,{withSpans:!1}).body.reduce((e,t)=>{const n=de.serialize(t);if(n.attributes&&n.attributes.length||n.comment){const t={};n.comment&&(t[n.comment.key]=n.comment.value),n.attributes&&n.attributes.length&&n.attributes.forEach(e=>{t[e.key]=e.value}),t.val=n.value,e[n.key]=t}else e[n.key]=n.value;return e},{});return t&&t(null,n),n};class ge{constructor(e,t={}){this.init(e,t),this.type="backend"}init(e,r={}){this.services=e,this.options=function(e){return t.call(n.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e}(r,this.options||{},{loadPath:"/locales/{{lng}}/{{ns}}.ftl",addPath:"/locales/add/{{lng}}/{{ns}}",parse:function(e,t){return ke(e)},crossDomain:!1,ajax:s})}read(e,t,n){var r=this.options.loadPath;"function"==typeof this.options.loadPath&&(r=this.options.loadPath([e],[t]));let s=this.services.interpolator.interpolate(r,{lng:e,ns:t});this.loadUrl(s,n)}loadUrl(e,t){this.options.ajax(e,this.options,(n,r)=>{if(r.status>=500&&r.status<600)return t("failed loading "+e,!0);if(r.status>=400&&r.status<500)return t("failed loading "+e,!1);let s,i;try{s=this.options.parse(n,e)}catch(t){i="failed parsing "+e+" to json"}if(i)return t(i,!1);t(null,s)})}create(e,t,n,r){"string"==typeof e&&(e=[e]);let s={};s[n]=r||"",e.forEach(e=>{let n=this.services.interpolator.interpolate(this.options.addPath,{lng:e,ns:t});this.options.ajax(n,this.options,function(e,t){},s)})}}return ge.type="backend",ge});
